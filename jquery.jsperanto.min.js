/*!
 * jQuery jsperanto
 *
 * Copyright 2010, Jean-Philippe Joyal (http://leastusedfeature.com)
 * MIT licensed.
 * https://github.com/jpjoyal/jsperanto/blob/master/MIT-LICENSE.txt
 *
 * 4/19/11 Rewrite by Sebastien P. (twitter.com/_sebastienp)
 */

(function(a,b,c){"use strict";if(a.fn.jquery&&!a.jsperanto){var d=0,e=c,f=c,g="plural_not_found_"+b.Math.random(),h={interpolationPrefix:"__",interpolationSuffix:"__",pluralSuffix:"_plural",maxRecursion:50,reusePrefix:"$t(",reuseSuffix:")",fallbackLang:"en-us",dicoPath:"locales",keyseparator:".",setDollarT:!c,dictionary:c,lang:c},i=function(){return e},j=function(){var a=b.navigator;return a?(a.language||a.userLanguage).toLowerCase():h.fallbackLang},k=function(b,c){function e(b,c){!c&&(c={});var i,j,l,m,n,p,q,r=c.defaultValue||b,s,t,u,v,w,x,y,z;if(f){u="replace",i=function(b,c){a.each(c,function(a,c){b=b[u](h.interpolationPrefix+a+h.interpolationSuffix,c)});return b},j="count";if(c[j]&&typeof c[j]!="string"&&c[j]>1){s=a.extend({},c),delete s[j],s.defaultValue=g,t=b+h.pluralSuffix,x=k(t,s);if(x!==g)return i(x,{count:c[j]})}q=b.split(h.keyseparator),l=0,y=f;while(q[l])y=y&&y[q[l]],l+=1;if(y){y=i(y,c),m="indexOf";while((n=y[m](h.reusePrefix))!==-1){if((d+=1)>h.maxRecursion)break;p=y[m](h.reuseSuffix,n)+h.reuseSuffix.length,v=y.substring(n,p),w=v[u](h.reusePrefix,"")[u](h.reuseSuffix,""),z=e(w,c),y=y[u](v,z)}return y}}return r}d=0;return e(b,c)},l=function(b,d){function i(b,d){h.dictionary?(f=h.dictionary,d(b)):a.ajax({cache:!c,dataType:"json",url:h.dicoPath+"/"+b+".json",success:function(a){f=a,d(b)},error:function(){b!==h.fallbackLang?i(h.fallbackLang,d):d(c)}})}var g="lang";a.extend(h,d),!h[g]&&(h[g]=j()),i(h[g],function(c){e=c,h.setDollarT&&!a.t&&(a.t=k),b(k)})};a.jsperanto={init:l,t:k,translate:k,detectLanguage:j,lang:i}}})(this.jQuery,this,!1)